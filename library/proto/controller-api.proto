syntax = "proto3";
package proto;

service ControllerService {
  rpc RegisterProcess(RegisterProcessRequest) returns (RegisterProcessResponse) {}
  rpc UnregisterProcess(UnregisterProcessRequest) returns (UnregisterProcessResponse) {}


  rpc RegisterMinion(RegisterMinionRequest) returns (RegisterMinionResponse) {}
  rpc UnregisterMinion(UnregisterMinionRequest) returns (UnregisterMinionResponse) {}

  rpc CreateCDIs(CreateCDIsRequest) returns (CreateCDIsResponse) {}
  rpc GetCDIsByProcessID(GetCDIsByProcessIDRequest) returns (GetCDIsByProcessIDResponse) {}
  rpc TransferCDIs(TransferCDIsRequest) returns (TransferCDIsResponse) {}
  rpc DeleteCDIs(DeleteCDIsRequest) returns (DeleteCDIsResponse) {}
}

message CdiConfig {
  string process_id = 1;
  string process_name = 2;
  string app_id = 3;
  string app_name = 4;
  string cdi_id = 5;
  int32 cdi_key = 6;
  int32 cdi_size_bytes = 7;
  int32 cdi_access_mode = 8;
  int32 uid = 9;
  int32 gid = 10;
  string payload = 11;
}

message RegisterProcessRequest {
  string id = 1;
  string name = 2;
  string namespace = 3;
  string node_ip = 4;
  string rpc_ip = 5;
  string rpc_port = 6;
  string uid = 7;
  string gid = 8;
}

message RegisterProcessResponse {
  string err = 1;
}

message UnregisterProcessRequest {
  string id = 1;
}

message UnregisterProcessResponse {
  string err = 1;
}

message RegisterMinionRequest {
  string name = 1;
  string namespace = 2;
  string node_ip = 3;
  string rpc_ip = 4;
  string rpc_port = 5;
}

message RegisterMinionResponse {
  string err = 1;
}

message UnregisterMinionRequest {
  string node_ip = 1;
}

message UnregisterMinionResponse {
  string err = 1;
}

message CreateCDIsRequest {
  string id = 1;
  repeated CdiConfig cdi_configs = 2;
}

message CreateCDIsResponse {
  string err = 1;
}

message GetCDIsByProcessIDRequest {
  string id = 1;
}

message GetCDIsByProcessIDResponse {
  repeated CdiConfig cdi_configs = 1;
  string err = 2;
}

message TransferCDIsRequest {
  string id = 1;
  string transfer_id = 2;
  string transfer_mode = 3;
  repeated CdiConfig cdi_configs = 4;
}

message TransferCDIsResponse {
  string err = 1;
}

message DeleteCDIsRequest {
  string id = 1;
  repeated CdiConfig cdi_configs = 3;
}

message DeleteCDIsResponse {
  string err = 1;
}
